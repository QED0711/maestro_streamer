(this.webpackJsonpmaestro_video=this.webpackJsonpmaestro_video||[]).push([[0],{101:function(e,t,n){},102:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(46),s=n.n(o),i=(n(59),n(60),n(61),n(12)),c=n(1),u=n(47),l=n.n(u),m={authority:null,knownAuthorities:{},sessionAuthorization:!0,ring:!1,userID:null,connectedUsers:[],localStreamID:null,streams:[],streamsData:{},showIDs:!1,chat:[]},d=n(6),h=n(15),v={appendStream:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.setStateMaster((function(n){var a=Object(h.a)(n.streams);return a.map((function(e){return e.id})).includes(e.id)||a.push(e),"local"===t?{streams:a,localStreamID:e.id}:{streams:a}}))},appendStreamData:function(e,t){this.setStateMaster((function(n){var a=Object(d.a)({},n.streamsData);return a[e]=t,{streamsData:a}}))},appendKnownAuthority:function(e,t){this.setStateMaster((function(n){var a=Object(d.a)({},n.knownAuthorities);return a[e]=t,{knownAuthorities:a}}))},appendChatMessage:function(e){this.setStateMaster((function(t){var n=Object(h.a)(t.chat);return n.push(e),{chat:n}}))},removeStream:function(e){this.setStateMaster((function(t){var n=Object(h.a)(t.streams);return{streams:n=n.filter((function(t){return e!==t.id}))}}))},appendUser:function(e){this.setStateMaster((function(t){var n=Object(h.a)(t.connectedUsers);return n.push(e),{connectedUsers:n}}))},toggleRing:function(){this.setStateMaster((function(e){return{ring:!e.ring}}))}},f={getAuthority:function(){return this.state.authority},getKnownAuthorites:function(){return this.state.knownAuthorities},getRing:function(){return this.state.ring},getUserID:function(){return this.state.userID},getConnectedUsers:function(){return this.state.connectedUsers}},p=new l.a(m);p.addCustomSetters(v),p.addMethods(f);var g=p.context,E=p.createProvider(),S=(n(63),n(48)),O=function(e){var t,n,a=new URLSearchParams(e),r={},o=Object(S.a)(a.keys());try{for(o.s();!(n=o.n()).done;){var s=n.value;t=a.getAll(s).length>1?a.getAll(s):a.get(s),(["0","0.0."].includes(t)||parseFloat(t))&&(t=parseFloat(t)),"false"===t&&(t=!1),"true"===t&&(t=!0),r[s]=t}}catch(i){o.e(i)}finally{o.f()}return r},D=function(){var e=Object(a.useContext)(g),t=e.state,n=e.setters,o=O(window.location.search);return Object(a.useEffect)((function(){!function(){var e;t.streams.forEach((function(a){(e=document.getElementById("video-".concat(a.id))).paused&&(e.muted=a.id===t.localStreamID,e.controls="controls",e.srcObject=a,e.addEventListener("loadedmetadata",(function(){e.play()})),e.addEventListener("mousedown",(function(e){e.preventDefault(),e.altKey&&n.removeStream(a.id)})))}))}()}),[t.streams]),r.a.createElement("div",{id:"media-panel"},t.streams.map((function(e){var n,a;return r.a.createElement("div",{className:"video-container",key:e.id,id:e.id},r.a.createElement("h3",{className:"video-header user-name"},t.localStreamID===e.id?o.name:(null===(n=t.streamsData[e.id])||void 0===n?void 0:n.name)||"--"),r.a.createElement("h4",{className:"video-header user-location"},t.localStreamID===e.id?o.location:(null===(a=t.streamsData[e.id])||void 0===a?void 0:a.location)||"--"),r.a.createElement("video",{id:"video-".concat(e.id)}),t.showIDs&&r.a.createElement("em",null,r.a.createElement("sub",{className:"sub-id"},e.id)))})))},_=function(e){var t=Object(a.useContext)(g).state;Object(c.g)().sessionID;return t.sessionAuthorization?r.a.createElement("div",{id:"session-window"},r.a.createElement(D,null)):r.a.createElement(c.a,{to:"/"})},w=n(50),b=n.n(w),I=n(51),C=n.n(I),j=n(11),T=Object({NODE_ENV:"production",PUBLIC_URL:"/maestro_streamer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_SERVER_HOST||j.server_host||window.location.hostname,y=Object({NODE_ENV:"production",PUBLIC_URL:"/maestro_streamer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_SERVER_PORT||j.server_port,R=Object({NODE_ENV:"production",PUBLIC_URL:"/maestro_streamer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_SERVER_PROTOCOL||j.server_protocol||"https",A=("".concat(R,"://").concat(T,":").concat(y,"/"),C()("https://maestrostreamer.com")),N={autoGainControl:{exact:!1},echoCancellation:{exact:!1},noiseSuppression:!1,sampleSize:{exact:16},channelCount:1},U=function(){var e=Object(a.useContext)(g),t=(e.state,e.setters),n=e.methods,o=Object(c.g)(),s=o.sessionID;o.name,o.location;return Object(a.useEffect)((function(){var e=O(window.location.search);t.setAuthority(e.authority||"basic"),console.log(e),e.showIDs&&t.setShowIDs(!0);var a=new b.a(void 0,{path:"/peerjs",host:j.server_host});a.on("open",(function(e){t.setUserID(e),A.emit("join-session",{sessionID:s,userID:e,part:"PART STAND-IN"})})),navigator.mediaDevices.getUserMedia({video:!1!==e.video,audio:!1!==e.audio&&Object(d.a)(Object(d.a)({},N),e)}).then((function(r){t.appendStream(r,"local");var o=function(e){A.emit("user-leaving",{streamID:r.id})};window.addEventListener("unload",o),window.addEventListener("beforeunload",o),a.on("call",(function(e){"admin"===n.getAuthority()||"admin"===e.metadata.authority?e.answer(r):e.answer(null),e.on("stream",(function(e){A.emit("request-user-data",{streamID:e.id}),t.appendStream(e)}))})),A.on("user-connected",(function(e){var o=e.userID,s=e.authority;if(console.log("RING: ".concat(s,",").concat(o)),console.log("CONNECTED USERS",n.getConnectedUsers()),!n.getConnectedUsers().includes(o)&&(["admin","monitor"].includes(s)||"admin"===n.getAuthority())){t.appendKnownAuthority(o,s);var i=a.call(o,r,{metadata:{authority:n.getAuthority()}});t.appendUser(o),i.on("stream",(function(e){t.appendStream(e)}))}})),A.on("data-requested",(function(t){t.streamID===r.id&&A.emit("data-response",Object(d.a)({streamID:r.id},e))}))})),A.on("user-data-response",(function(e){t.appendStreamData(e.streamID,e)})),A.on("user-disconnected",(function(e){})),A.on("remove-stale-user",(function(e){console.log("WILL REMOVE STALE USER"),console.log(e),t.removeStream(e.streamID)})),A.on("message-received",(function(e){var n=e.name,a=e.message;t.appendChatMessage({name:n,message:a,self:!1,time:Date.now()})}))}),[]),r.a.createElement(r.a.Fragment,null)},x=n(18),P=n.n(x),M=n(52),L=function(){var e=Object(a.useContext)(g),t=e.state,n=e.setters,o=e.methods,s=Object(c.g)().sessionID,i=function(){var e=Object(M.a)(P.a.mark((function e(t){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.toggleRing();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){if(t.ring)var e=setInterval((function(){var t=o.getUserID(),n=o.getRing(),a=o.getAuthority();t&&(n?A.emit("ring",{sessionID:s,userID:t,authority:a}):clearInterval(e))}),1e3)}),[t.ring]),r.a.createElement("div",{id:"config-panel"},r.a.createElement("button",{onClick:i},t.ring?"Stop Ringing":"Ring"))},k=n(53),K=(n(101),function(){var e=Object(a.useContext)(g),t=e.state,n=e.setters,o=Object(a.useState)(!0),s=Object(k.a)(o,2),i=s[0],c=s[1],u=O(window.location.search),l=Object(a.useRef)(null),m=Object(a.useRef)(null),h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"hours"===t&&e>12&&(e-=12),e>=10?e:"0".concat(e)};return Object(a.useEffect)((function(){var e=l.current;i&&(e.scrollTop=e.scrollHeight)}),[t.chat,i]),r.a.createElement("div",{id:"chat-box"},r.a.createElement("div",{id:"chat-box-display",ref:l,onScroll:function(e){var t=e.target.scrollTop+e.target.clientHeight;e.target.scrollHeight-100<=t?c(!0):c(!1)}},t.chat.map((function(e){var t=new Date(e.time),n="".concat(h(t.getHours(),"hours"),":").concat(h(t.getMinutes()),":").concat(h(t.getSeconds()));return r.a.createElement("div",{className:"chat-message-container from-self-".concat(e.self),key:e.time},r.a.createElement("div",{className:"chat-message-header"},r.a.createElement("div",{className:"chat-message-sender"},e.name),r.a.createElement("div",{className:"chat-message-time"},n)),r.a.createElement("div",{className:"chat-message-content"},e.message))}))),r.a.createElement("form",{id:"chat-box-form",onSubmit:function(e){console.log("SUBMITTING"),e.preventDefault();var t=e.target.firstChild,a=t.value;if(t.value="",/\w{1,}/.test(a)){var r={name:u.name||"anonymous",message:a};A.emit("chat-message",r),n.appendChatMessage(Object(d.a)(Object(d.a)({},r),{},{self:!0,time:Date.now()}))}},ref:m},r.a.createElement("textarea",{onKeyDown:function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),m.current.dispatchEvent(new Event("submit")))}})))});var W=function(){return r.a.createElement(i.a,{basename:"/maestro_streamer/"},r.a.createElement("div",{className:"App"},r.a.createElement(c.d,null,r.a.createElement(c.b,{exact:!0,path:"/"},"Maestro Streamer"),r.a.createElement(c.b,{exact:!0,path:"/session/:sessionID"},r.a.createElement(U,null),r.a.createElement(L,null),r.a.createElement(_,null),r.a.createElement(K,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(E,null,r.a.createElement(W,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},11:function(e){e.exports=JSON.parse('{"server_protocol":"https","server_host_l":"192.168.1.217","server_host_r":"52.207.166.31","server_host":"maestrostreamer.com","server_port":"4000"}')},54:function(e,t,n){e.exports=n(102)},59:function(e,t,n){},60:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},61:function(e,t,n){},63:function(e,t,n){},68:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=68},98:function(e,t){}},[[54,1,2]]]);
//# sourceMappingURL=main.ac5f3925.chunk.js.map