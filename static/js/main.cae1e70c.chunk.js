(this.webpackJsonpmaestro_video=this.webpackJsonpmaestro_video||[]).push([[0],{100:function(e,t){},103:function(e,t,a){},104:function(e,t,a){},105:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(48),s=a.n(r),c=(a(61),a(62),a(63),a(12)),i=a(1),l=a(49),u=a.n(l),m={authority:null,knownAuthorities:{},sessionAuthorization:!0,ring:!1,userID:null,connectedUsers:[],localStreamID:null,streams:[],streamsData:{},showIDs:!1,chat:[]},d=a(6),h=a(10),f={appendStream:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.setStateMaster((function(a){var n=Object(h.a)(a.streams);return n.map((function(e){return e.id})).includes(e.id)||n.push(e),"local"===t?{streams:n,localStreamID:e.id}:{streams:n}}))},appendStreamData:function(e,t){this.setStateMaster((function(a){var n=Object(d.a)({},a.streamsData);return n[e]=t,{streamsData:n}}))},appendKnownAuthority:function(e,t){this.setStateMaster((function(a){var n=Object(d.a)({},a.knownAuthorities);return n[e]=t,{knownAuthorities:n}}))},appendChatMessage:function(e){this.setStateMaster((function(t){var a=Object(h.a)(t.chat);return a.push(e),{chat:a}}))},removeStream:function(e){this.setStateMaster((function(t){var a=Object(h.a)(t.streams);return{streams:a=a.filter((function(t){return e!==t.id}))}}))},appendUser:function(e){this.setStateMaster((function(t){var a=Object(h.a)(t.connectedUsers);return a.push(e),{connectedUsers:a}}))},toggleRing:function(){this.setStateMaster((function(e){return{ring:!e.ring}}))}},v={getAuthority:function(){return this.state.authority},getKnownAuthorites:function(){return this.state.knownAuthorities},getRing:function(){return this.state.ring},getUserID:function(){return this.state.userID},getConnectedUsers:function(){return this.state.connectedUsers}},E=new u.a(m);E.addCustomSetters(f),E.addMethods(v);var p=E.context,g=E.createProvider(),b=(a(65),a(20)),O=function(e){var t,a,n=new URLSearchParams(e),o={},r=Object(b.a)(n.keys());try{for(r.s();!(a=r.n()).done;){var s=a.value;t=n.getAll(s).length>1?n.getAll(s):n.get(s),(["0","0.0."].includes(t)||parseFloat(t))&&(t=parseFloat(t)),"false"===t&&(t=!1),"true"===t&&(t=!0),o[s]=t}}catch(c){r.e(c)}finally{r.f()}return o},S=function(){var e=Object(n.useContext)(p),t=e.state,a=e.setters,r=O(window.location.search);return Object(n.useEffect)((function(){!function(){var e;t.streams.forEach((function(n){(e=document.getElementById("video-".concat(n.id))).paused&&(e.muted=n.id===t.localStreamID,e.controls="controls",e.srcObject=n,e.addEventListener("loadedmetadata",(function(){e.play()})),e.addEventListener("mousedown",(function(e){e.preventDefault(),e.altKey&&a.removeStream(n.id)})))}))}()}),[t.streams]),o.a.createElement("div",{id:"media-panel"},t.streams.map((function(e){var a,n;return o.a.createElement("div",{className:"video-container",key:e.id,id:e.id},o.a.createElement("h3",{className:"video-header user-name"},t.localStreamID===e.id?r.name:(null===(a=t.streamsData[e.id])||void 0===a?void 0:a.name)||"--"),o.a.createElement("h4",{className:"video-header user-location"},t.localStreamID===e.id?r.location:(null===(n=t.streamsData[e.id])||void 0===n?void 0:n.location)||"--"),o.a.createElement("video",{id:"video-".concat(e.id)}),t.showIDs&&o.a.createElement("em",null,o.a.createElement("sub",{className:"sub-id"},e.id)))})))},y=function(e){var t=Object(n.useContext)(p).state;Object(i.g)().sessionID;return t.sessionAuthorization?o.a.createElement("div",{id:"session-window"},o.a.createElement(S,null)):o.a.createElement(i.a,{to:"/"})},D=a(51),C=a.n(D),w=a(52),_=a.n(w),j=a(14),I=Object({NODE_ENV:"production",PUBLIC_URL:"/maestro_streamer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_SERVER_HOST||j.server_host||window.location.hostname,N=Object({NODE_ENV:"production",PUBLIC_URL:"/maestro_streamer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_SERVER_PORT||j.server_port,k=Object({NODE_ENV:"production",PUBLIC_URL:"/maestro_streamer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_SERVER_PROTOCOL||j.server_protocol||"https",A=("".concat(k,"://").concat(I,":").concat(N,"/"),_()("https://maestrostreamer.com")),T={autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,sampleSize:16,channelCount:1},R=function(){var e=Object(n.useContext)(p),t=(e.state,e.setters),a=e.methods,r=Object(i.g)().sessionID;return Object(n.useEffect)((function(){var e=O(window.location.search);t.setAuthority(e.authority||"basic"),console.log(e),e.showIDs&&t.setShowIDs(!0);var n=new C.a(void 0,{path:"/peerjs",host:j.server_host});n.on("open",(function(e){t.setUserID(e),A.emit("join-session",{sessionID:r,userID:e,part:"PART STAND-IN"})})),navigator.mediaDevices.getUserMedia({video:!1!==e.video,audio:!1!==e.audio&&Object(d.a)(Object(d.a)({},T),e)}).then((function(o){t.appendStream(o,"local");var r=function(e){A.emit("user-leaving",{streamID:o.id})};window.addEventListener("unload",r),window.addEventListener("beforeunload",r),n.on("call",(function(e){"admin"===a.getAuthority()||"admin"===e.metadata.authority?e.answer(o):e.answer(null),e.on("stream",(function(e){A.emit("request-user-data",{streamID:e.id}),t.appendStream(e)}))})),A.on("user-connected",(function(e){var r=e.userID,s=e.authority;if(console.log("RING: ".concat(s,",").concat(r)),console.log("CONNECTED USERS",a.getConnectedUsers()),!a.getConnectedUsers().includes(r)&&(["admin","monitor"].includes(s)||"admin"===a.getAuthority())){t.appendKnownAuthority(r,s);var c=n.call(r,o,{metadata:{authority:a.getAuthority()}});t.appendUser(r),c.on("stream",(function(e){t.appendStream(e)}))}})),A.on("data-requested",(function(t){t.streamID===o.id&&A.emit("data-response",Object(d.a)({streamID:o.id},e))}))})),A.on("user-data-response",(function(e){t.appendStreamData(e.streamID,e)})),A.on("user-disconnected",(function(e){})),A.on("remove-stale-user",(function(e){console.log("WILL REMOVE STALE USER"),console.log(e),t.removeStream(e.streamID)})),A.on("message-received",(function(e){var a=e.name,n=e.message;t.appendChatMessage({name:a,message:n,self:!1,time:Date.now()})}))}),[]),o.a.createElement(o.a.Fragment,null)},x=a(19),U=a.n(x),P=a(53),F=function(){var e=Object(n.useContext)(p),t=e.state,a=e.setters,r=e.methods,s=Object(i.g)().sessionID,c=function(){var e=Object(P.a)(U.a.mark((function e(t){return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.toggleRing();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){if(t.ring)var e=setInterval((function(){var t=r.getUserID(),a=r.getRing(),n=r.getAuthority();t&&(a?A.emit("ring",{sessionID:s,userID:t,authority:n}):clearInterval(e))}),1e3)}),[t.ring]),o.a.createElement("div",{id:"config-panel"},o.a.createElement("button",{onClick:c},t.ring?"Stop Ringing":"Ring"))},M=a(8),L=(a(103),function(){var e=Object(n.useContext)(p),t=e.state,a=e.setters,r=Object(n.useState)(!0),s=Object(M.a)(r,2),c=s[0],i=s[1],l=O(window.location.search),u=Object(n.useRef)(null),m=Object(n.useRef)(null),h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"hours"===t&&e>12&&(e-=12),e>=10?e:"0".concat(e)};return Object(n.useEffect)((function(){var e=u.current;c&&(e.scrollTop=e.scrollHeight)}),[t.chat,c]),o.a.createElement("div",{id:"chat-box"},o.a.createElement("div",{id:"chat-box-display",ref:u,onScroll:function(e){var t=e.target.scrollTop+e.target.clientHeight;e.target.scrollHeight-100<=t?i(!0):i(!1)}},t.chat.map((function(e){var t=new Date(e.time),a="".concat(h(t.getHours(),"hours"),":").concat(h(t.getMinutes()),":").concat(h(t.getSeconds()));return o.a.createElement("div",{className:"chat-message-container from-self-".concat(e.self),key:e.time},o.a.createElement("div",{className:"chat-message-header"},o.a.createElement("div",{className:"chat-message-sender"},e.name),o.a.createElement("div",{className:"chat-message-time"},a)),o.a.createElement("div",{className:"chat-message-content"},e.message))}))),o.a.createElement("form",{id:"chat-box-form",onSubmit:function(e){console.log("SUBMITTING"),e.preventDefault();var t=e.target.firstChild,n=t.value;if(t.value="",/\w{1,}/.test(n)){var o={name:l.name||"anonymous",message:n};A.emit("chat-message",o),a.appendChatMessage(Object(d.a)(Object(d.a)({},o),{},{self:!0,time:Date.now()}))}},ref:m},o.a.createElement("textarea",{onKeyDown:function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),m.current.dispatchEvent(new Event("submit")))}})))}),K=(a(104),function(){var e=Object(n.useContext)(p),t=(e.state,e.setters,Object(i.g)().sessionID),a=Object(n.useState)(null),r=Object(M.a)(a,2),s=r[0],c=r[1],l=Object(n.useState)(!1),u=Object(M.a)(l,2),m=u[0],d=u[1],f=Object(n.useState)(""),v=Object(M.a)(f,2),E=v[0],g=v[1];return Object(n.useEffect)((function(){var e=O(window.location.search);c(e)}),[]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{id:"media-settings-panel",onChange:function(e){d(!0),g(function(){var e,t,a,n=Object(h.a)(document.getElementsByClassName("media-setting")),o="",r=Object(b.a)(n);try{for(r.s();!(a=r.n()).done;){var s=a.value;e=s.dataset.key,t="checkbox"===s.type?s.checked:s.value,o+="".concat(e,"=").concat(t,"&")}}catch(c){r.e(c)}finally{r.f()}return o}())}},s&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"media-settings-section"},o.a.createElement("label",{htmlFor:"user-name"},"Name "),o.a.createElement("input",{id:"user-name",className:"media-setting","data-key":"name",defaultValue:s.name||""}),o.a.createElement("br",null),o.a.createElement("label",{htmlFor:"user-location"},"Location "),o.a.createElement("input",{id:"user-location",className:"media-setting","data-key":"location",defaultValue:s.location||""}),o.a.createElement("br",null),o.a.createElement("label",{htmlFor:"user-location"},"Authority "),o.a.createElement("select",{"data-key":"authority",className:"media-setting",defaultValue:s.authority||"basic"},o.a.createElement("option",{value:"admin"},"Admin"),o.a.createElement("option",{value:"monitor"},"Monitor"),o.a.createElement("option",{value:"basic"},"Performer"))),o.a.createElement("div",{className:"media-settings-section"},o.a.createElement("label",{htmlFor:"audio-include"},"Include Audio "),o.a.createElement("input",{type:"checkbox",className:"media-setting","data-key":"audio",defaultChecked:!1!==s.audio}),o.a.createElement("br",null),o.a.createElement("label",{htmlFor:"audio-gain"},"Auto Gain Control "),o.a.createElement("input",{type:"checkbox",className:"media-setting","data-key":"autoGainControl",defaultChecked:s.autoGainControl||!1}),o.a.createElement("br",null),o.a.createElement("label",{htmlFor:"audio-echo"},"Echo Cancellation "),o.a.createElement("input",{type:"checkbox",className:"media-setting","data-key":"echoCancellation",defaultChecked:s.echoCancellation||!1}),o.a.createElement("br",null),o.a.createElement("label",{htmlFor:"audio-noise"},"Noise Suppression "),o.a.createElement("input",{type:"checkbox",className:"media-setting","data-key":"noiseSuppression",defaultChecked:s.noiseSuppression||!1}),o.a.createElement("br",null),o.a.createElement("label",{htmlFor:"audio-channels"},"Channel Count "),o.a.createElement("select",{"data-key":"channelCount",className:"media-setting",defaultValue:s.channelCount||"1"},o.a.createElement("option",{value:"1"},"1"),o.a.createElement("option",{value:"2"},"2")),o.a.createElement("br",null),o.a.createElement("label",{htmlFor:"audio-samples"},"Sample Size "),o.a.createElement("select",{"data-key":"sampleSize",className:"media-setting",defaultValue:s.sampleSize||"16"},o.a.createElement("option",{value:"8"},"8"),o.a.createElement("option",{value:"16"},"16"),o.a.createElement("option",{value:"24"},"24"),o.a.createElement("option",{value:"32"},"32"))),o.a.createElement("div",{className:"media-settings-section"},o.a.createElement("label",{htmlFor:"video-include"},"Include Video "),o.a.createElement("input",{type:"checkbox",className:"media-setting","data-key":"video",defaultChecked:!1!==s.video}),o.a.createElement("br",null),o.a.createElement("label",{htmlFor:"video-width"},"Width "),o.a.createElement("input",{type:"number",className:"media-setting","data-key":"width",step:"1",min:"10",max:"9999",defaultValue:s.width||"1920"}),o.a.createElement("br",null),o.a.createElement("label",{htmlFor:"video-height"},"Height "),o.a.createElement("input",{type:"number",className:"media-setting","data-key":"height",step:"1",min:"10",max:"9999",defaultValue:s.height||"1080"})))),m&&o.a.createElement("a",{href:"/session/".concat(t,"?").concat(E)},"Apply"))}),V=a(54),W=a.n(V),H=a(55),B=a.n(H),z=function(){var e=Object(n.useState)(!1),t=Object(M.a)(e,2),a=t[0],r=t[1];return o.a.createElement("div",{style:{textAlign:"left"}},o.a.createElement("div",{onClick:function(e){r(!a)},style:{cursor:"pointer",display:"inline-block"}},a?o.a.createElement("img",{src:B.a}):o.a.createElement("img",{src:W.a})),a&&o.a.createElement(K,null))};var G=function(){return o.a.createElement(c.a,{basename:"/maestro_streamer/"},o.a.createElement("div",{className:"App"},o.a.createElement(i.d,null,o.a.createElement(i.b,{exact:!0,path:"/"},"Maestro Streamer"),o.a.createElement(i.b,{exact:!0,path:"/session/:sessionID"},o.a.createElement(R,null),o.a.createElement(z,null),o.a.createElement(F,null),o.a.createElement(y,null),o.a.createElement(L,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(g,null,o.a.createElement(G,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},14:function(e){e.exports=JSON.parse('{"server_protocol":"https","server_host_l":"192.168.1.217","server_host_r":"52.207.166.31","server_host":"maestrostreamer.com","server_port":"4000"}')},54:function(e,t,a){e.exports=a.p+"static/media/menu.55f68494.svg"},55:function(e,t,a){e.exports=a.p+"static/media/close.98fdc312.svg"},56:function(e,t,a){e.exports=a(105)},61:function(e,t,a){},62:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},63:function(e,t,a){},65:function(e,t,a){},70:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=70}},[[56,1,2]]]);
//# sourceMappingURL=main.cae1e70c.chunk.js.map